(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{133:function(e,t,n){},134:function(e,t,n){"use strict";n.r(t);var o=n(1),i=n.n(o),r=n(42),a=n.n(r),s=n(15),u=n.n(s),c=n(5),h=n(14),l=n(0),d=n(23),v=n.n(d),m=function e(t,n,o,i,r){var a=this;Object(c.a)(this,e),this.coordinates=void 0,this.touchZoomDistance=void 0,this.drag=void 0,this.click=void 0,this.zoomIn=void 0,this.zoomOut=void 0,this.zoomStartHandler=function(e){a.isTwoTouches(e)&&(e.preventDefault(),a.touchZoomDistance=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY))},this.zoomMoveHandler=function(e){if(a.isTwoTouches(e)){e.preventDefault();var t=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY),n=t-a.touchZoomDistance;console.log(n),Math.abs(n)>10&&(n<0?a.zoomOut():a.zoomIn(),a.touchZoomDistance=t)}},this.mouseWheelHandler=function(e){e.preventDefault(),Math.max(-1,Math.min(1,-e.deltaY))<0&&a.zoomOut?a.zoomOut():a.zoomIn&&a.zoomIn()},this.getCoordinates=function(e){return e instanceof MouseEvent?{x:e.clientX,y:e.clientY}:{x:e.touches[0].pageX,y:e.touches[0].pageY}},this.downHandler=function(e){if(!a.isTwoTouches(e)){e.preventDefault();var t=a.getCoordinates(e),n=t.x,o=t.y;a.coordinates={startX:n,startY:o,currentX:n,currentY:o}}},this.moveHandler=function(e){if(!a.isTwoTouches(e)){e.preventDefault();var t=a.getCoordinates(e),n=t.x,o=t.y;a.isInteractionStarted(a.coordinates)&&(a.drag&&a.drag(n-a.coordinates.currentX,o-a.coordinates.currentY),a.coordinates.currentX=n,a.coordinates.currentY=o)}},this.endHandler=function(e){e.preventDefault(),a.isClicked(a.coordinates)&&a.click&&a.click(a.coordinates.currentX,a.coordinates.currentY),a.coordinates=null,a.touchZoomDistance=0},this.isClicked=function(e){return a.isInteractionStarted(e)&&!a.isDrag(e)&&a.click&&!a.touchZoomDistance},this.isInteractionStarted=function(e){return!!e},this.isDrag=function(e){return Math.abs(e.startX-e.currentX)>3||Math.abs(e.startY-e.currentY)>3},this.isTwoTouches=function(e){return 2===v()(e,"touches.length")},this.coordinates=null,this.touchZoomDistance=0,this.drag=n,this.zoomIn=i,this.zoomOut=r,this.click=o,t.addEventListener("wheel",this.mouseWheelHandler),t.addEventListener("mousedown",this.downHandler),t.addEventListener("mousemove",this.moveHandler),t.addEventListener("mouseup",this.endHandler),t.addEventListener("touchstart",this.downHandler),t.addEventListener("touchmove",this.moveHandler),t.addEventListener("touchend",this.endHandler),t.addEventListener("touchstart",this.zoomStartHandler),t.addEventListener("touchmove",this.zoomMoveHandler)},p={PE:1,BF:2,FR:3,LY:4,BY:5,PK:6,ID:7,YE:8,MG:9,BO:10,CI:11,DZ:12,CH:13,CM:14,MK:15,BW:16,UA:17,KE:18,TW:19,JO:20,MX:21,AE:22,BZ:23,BR:24,SL:25,ML:26,CD:27,IT:28,SO:29,AF:30,BD:31,DO:32,GW:33,GH:34,AT:35,SE:36,TR:37,UG:38,MZ:39,JP:40,NZ:41,CU:42,VE:43,PT:44,CO:45,MR:46,AO:47,DE:48,SD:49,TH:50,AU:51,PG:52,IQ:53,HR:54,GL:55,NE:56,DK:57,LV:58,RO:59,ZM:60,IR:61,MM:62,ET:63,GT:64,SR:65,EH:66,CZ:67,TD:68,AL:69,FI:70,SY:71,KG:72,SB:73,OM:74,PA:75,AR:76,GB:77,CR:78,PY:79,GN:80,IE:81,NG:82,TN:83,PL:84,NA:85,ZA:86,EG:87,TZ:88,GE:89,SA:90,VN:91,RU:92,HT:93,BA:94,IN:95,CN:96,CA:97,SV:98,GY:99,BE:100,GQ:101,LS:102,BG:103,BI:104,DJ:105,AZ:106,MY:107,PH:108,UY:109,CG:110,RS:111,ME:112,EE:113,RW:114,AM:115,SN:116,TG:117,ES:118,GA:119,HU:120,MW:121,TJ:122,KH:123,KR:124,HN:125,IS:126,NI:127,CL:128,MA:129,LR:130,NL:131,CF:132,SK:133,LT:134,ZW:135,LK:136,IL:137,LA:138,KP:139,GR:140,TM:141,EC:142,BJ:143,SI:144,NO:145,MD:146,LB:147,NP:148,ER:149,US:150,KZ:151,AQ:152,SZ:153,UZ:154,MN:155,BT:156,NC:157,FJ:158,KW:159,TL:160,BS:161,VU:162,FK:163,GM:164,QA:165,JM:166,CY:167,PR:168,PS:169,BN:170,TT:171,CV:172,PF:173,WS:174,LU:175,KM:176,MU:177,FO:178,ST:179,AN:180,DM:181,TO:182,KI:183,FM:184,BH:185,AD:186,MP:187,PW:188,SC:189,AG:190,BB:191,TC:192,VC:193,LC:194,YT:195,VI:196,GD:197,MT:198,MV:199,KY:200,KN:201,MS:202,BL:203,NU:204,PM:205,CK:206,WF:207,AS:208,MH:209,AW:210,LI:211,VG:212,SH:213,JE:214,AI:215,MF_1_:216,GG:217,SM:218,BM:219,TV:220,NR:221,GI:222,PN:223,MC:224,VA:225,IM:226,GU:227,SG:228},f=n(43),g=n.n(f),C=function(){function e(t){var n=this,o=t.scene,i=t.renderer,r=t.mapUniforms,a=t.lookupContext,s=t.lookupTexture,u=t.camera;Object(c.a)(this,e),this.renderer=void 0,this.lookupContext=void 0,this.camera=void 0,this.lookupTexture=void 0,this.scene=void 0,this.mapUniforms=void 0,this.previousColorIndex=void 0,this.onCountryClick=function(e,t){n.cleanupContext();var o=n.getMouseCoordinates(e,t),i=o.mouseX,r=o.mouseY,a=n.getPickColor(i,r)||n.previousColorIndex;if(a){n.previousColorIndex=a;var s=g()(p,function(e){return e===a});s&&n.highlightCountry(s)}n.highlightOcean()},this.scene=o,this.renderer=i,this.mapUniforms=r,this.lookupContext=a,this.lookupTexture=s,this.camera=u,this.previousColorIndex=0,this.highlightOcean()}return Object(h.a)(e,[{key:"getMouseCoordinates",value:function(e,t){var n=this.renderer.context.canvas;return{mouseX:e-n.offsetLeft,mouseY:-t+n.height+n.offsetTop}}},{key:"getPickColor",value:function(e,t){this.mapUniforms.outlineLevel.value=0,this.renderer.clear(),this.renderer.render(this.scene,this.camera);var n=this.renderer.context,o=new Uint8Array(4);return n.readPixels(e,t,1,1,n.RGBA,n.UNSIGNED_BYTE,o),this.mapUniforms.outlineLevel.value=1,o[0]}},{key:"cleanupContext",value:function(){this.lookupContext.clearRect(0,0,256,1),this.lookupTexture.needsUpdate=!0}},{key:"highlightOcean",value:function(){var e=this.lookupContext;e.fillStyle="rgb(10,10,10)",e.fillRect(0,0,1,1),this.lookupTexture.needsUpdate=!0}},{key:"highlightCountry",value:function(e){if(this.cleanupContext(),e){var t=p[e],n=this.lookupContext;n.fillStyle="#eeeeee",n.fillRect(t,0,1,1)}this.lookupTexture.needsUpdate=!0}}]),e}(),k=function(){function e(t){Object(c.a)(this,e),this.container=void 0,this.renderer=void 0,this.scene=void 0,this.lookupContext=void 0,this.lookupTexture=void 0,this.camera=void 0,this.center=void 0,this.globe=void 0,this.mapUniforms=void 0,this.container=t,this.renderer=e.getRenderer(t),this.scene=e.getScene(),this.camera=e.getCamera(),this.center=e.getCenter(),this.camera.lookAt(this.center);var n=e.getAmbientLight();this.scene.add(n);var o=e.getLookupCanvas();this.lookupContext=e.getLookupContext(o),this.lookupTexture=e.getLookupTexture(o),this.mapUniforms=e.getMapUniforms(this.lookupTexture),this.globe=e.createGlobe(this.mapUniforms),this.scene.add(this.globe);var i=new C({scene:this.scene,lookupContext:this.lookupContext,lookupTexture:this.lookupTexture,mapUniforms:this.mapUniforms,renderer:this.renderer,camera:this.camera});new m(t,this.drag.bind(this),i.onCountryClick,this.zoomIn.bind(this),this.zoomOut.bind(this))}return Object(h.a)(e,[{key:"drag",value:function(e,t){var n=Math.PI/450,o=n*e,i=n*t,r=this.camera.position.sub(this.center),a=r.length(),s=Math.acos(r.z/a),u=Math.atan2(r.y,r.x);s=Math.min(Math.max(s-i,0),Math.PI),u-=o,r.x=a*Math.sin(s)*Math.cos(u),r.y=a*Math.sin(s)*Math.sin(u),r.z=a*Math.cos(s),this.camera.position.add(this.center),this.camera.lookAt(this.center)}},{key:"zoomIn",value:function(){this.camera.position.length()>1&&this.camera.position.sub(this.center).multiplyScalar(.95).add(this.center)}},{key:"zoomOut",value:function(){this.camera.position.length()<4&&this.camera.position.sub(this.center).multiplyScalar(1.05).add(this.center)}},{key:"render",value:function(){var e=this.renderer,t=this.globe,n=this.scene,o=this.camera,i=this.container,r=[];r.push(function(e){t.rotateZ(1/32*e)}),window.addEventListener("resize",function(){o.aspect=i.clientWidth/i.clientHeight,o.updateProjectionMatrix(),e.setSize(i.clientWidth,i.clientHeight)}),r.push(function(){e.render(n,o)});var a=null;requestAnimationFrame(function e(t){a=a||t-1e3/60;var n=Math.min(200,t-a);a=t,r.forEach(function(e){e(n/1e3,t/1e3)}),requestAnimationFrame(e)})}}],[{key:"getRenderer",value:function(e){var t=new l.l;return t.setSize(window.innerWidth,window.innerHeight),e.appendChild(t.domElement),t}},{key:"getScene",value:function(){return new l.f}},{key:"getCamera",value:function(){var e=new l.e(45,window.innerWidth/window.innerHeight,.01,300);return e.up=new l.k(0,0,1),e.position.x=2,e}},{key:"getCenter",value:function(){return new l.k}},{key:"getAmbientLight",value:function(){return new l.a(16777215)}},{key:"getLookupCanvas",value:function(){var e=document.createElement("canvas");return e.width=256,e.height=1,e}},{key:"getLookupContext",value:function(e){var t=e.getContext("2d");if(!t)throw new Error("Lookup context is empty!");return t}},{key:"getLookupTexture",value:function(e){var t=new l.i(e);return t.magFilter=l.d,t.minFilter=l.d,t}},{key:"getMapUniforms",value:function(e){var t=new l.j,n=t.load("img/map_indexed.png");return n.magFilter=l.d,n.minFilter=l.d,{mapIndex:{type:"t",value:n},outline:{type:"t",value:t.load("img/map_outline.png")},lookup:{type:"t",value:e},outlineLevel:{type:"f",value:1}}}},{key:"createGlobe",value:function(e){var t=new l.g({uniforms:e,vertexShader:"#define GLSLIFY 1\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvoid main()\n{\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    vNormal = normalize(normalMatrix * normal);\n    vUv = uv;\n}\n",fragmentShader:"#define GLSLIFY 1\nuniform sampler2D mapIndex;\nuniform sampler2D lookup;\nuniform sampler2D outline;\nuniform float outlineLevel;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvoid main() {\n    vec4 mapColor = texture2D(mapIndex, vUv);\n    float indexedColor = mapColor.x;\n    vec2 lookupUV = vec2(indexedColor, 0.);\n    vec4 lookupColor = texture2D(lookup, lookupUV);\n    float mask = lookupColor.x + (1.-outlineLevel) * indexedColor;\n    mask = clamp(mask, 0., 1.);\n    float outlineColor = texture2D(outline, vUv).x * outlineLevel;\n    float diffuse = mask + outlineColor;\n    gl_FragColor = vec4(vec3(diffuse), 1.);\n}"});return new l.c(new l.h(.5,32,32).rotateX(l.b.degToRad(90)),t)}}]),e}();var x=function(){var e=function(){var e=Object(o.useRef)(null);return Object(o.useEffect)(function(){e.current&&new k(e.current).render()}),e}();return i.a.createElement("div",{className:u.a.app},i.a.createElement("header",{className:u.a.appHeader},"CLEAN PLANET"),i.a.createElement("main",{className:u.a.threeContainer,ref:e}),i.a.createElement("footer",null,"\xa9 Anton Chernov 2019"))};n(133),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(i.a.createElement(x,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},15:function(e,t,n){e.exports={app:"app_app__cewju",appHeader:"app_appHeader__3YfRd",threeContainer:"app_threeContainer__2B4F2"}},44:function(e,t,n){e.exports=n(134)}},[[44,1,2]]]);
//# sourceMappingURL=main.1de7dbfe.chunk.js.map